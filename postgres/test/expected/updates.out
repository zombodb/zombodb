set datestyle to 'iso, mdy';
SELECT assert('# of posts', 165240, count(*)) FROM so_posts;
 assert 
--------
 165240
(1 row)

BEGIN;
UPDATE so_posts SET id = id WHERE id IN (SELECT id FROM so_posts ORDER BY random() LIMIT 1000);
SELECT assert('# of posts', 165240, count(*)) FROM so_posts;
 assert 
--------
 165240
(1 row)

SELECT assert('estimated count', 1000 + (SELECT count(*) FROM so_posts), zdb_estimate_count('so_posts', ''));
 assert 
--------
 166240
(1 row)

COMMIT;
SELECT assert('estimated count', (SELECT count(*) FROM so_posts), zdb_estimate_count('so_posts', ''));
 assert 
--------
 165240
(1 row)

BEGIN;
UPDATE so_posts SET id = id WHERE id IN (SELECT id FROM so_posts ORDER BY random() LIMIT 1000);
SELECT assert('# of posts', 165240, count(*)) FROM so_posts;
 assert 
--------
 165240
(1 row)

SELECT assert('estimated count', 1000 + (SELECT count(*) FROM so_posts), zdb_estimate_count('so_posts', ''));
 assert 
--------
 166240
(1 row)

ABORT;
SELECT assert('estimated count', (SELECT count(*) FROM so_posts), zdb_estimate_count('so_posts', ''));
 assert 
--------
 165240
(1 row)

